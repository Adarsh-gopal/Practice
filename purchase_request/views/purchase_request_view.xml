<?xml version="1.0"?>
<odoo>
	<record model="ir.ui.view" id="view_purchase_request_form">
		<field name="name">purchase.request.form</field>
		<field name="model">purchase.request</field>
		<field name="arch" type="xml">
			<form string="Purchase Request" delete="false">
				<header>
					<button name="button_draft"
						string="Reset" type="object"
						groups="purchase_request.group_purchase_request_manager" attrs="{'invisible': [('z_check_status','=', 'Close')]}"/>
					<button name="button_to_approve" states="draft" string="Request approval"
						type="object" class="oe_highlight" />
					<!-- <button name="button_approved" string="Approve"
						type="object" class="oe_highlight"  attrs="{'invisible': [('state','not in', 'to_approve')]}"/>
					<button name="button_second_approved" string="Second Approve"
						type="object" class="oe_highlight"  attrs="{'invisible': [('state','not in', 'level_a_approved')]}"/> -->
					<!-- <button name="button_approved_level2" string="CEO Approval"
						type="object" class="oe_highlight"  attrs="{'invisible': [('state','not in', 'level_a_approved')]}"/> -->
					<!-- <button name="button_rejected"
						string="Reject" type="object" attrs="{'invisible': ['|','|',('z_check_status','=', 'Close'),('state','in', ['draft','approved'])]}"/> -->
					<button name="button_check" string="Check avalability" type="object" class="oe_highlight"/>
					<field name="state" widget="statusbar"
						statusbar_visible="draft,to_approve,close"
					 />
				</header>
				<sheet>
					<div class="oe_edit_only">
						<label for="name" class="oe_inline" />
						<label for="origin" class="oe_inline" />
					</div>
					<h1>
						<field name="is_editable" invisible="1" />
						<field name="name" class="oe_inline"
							readonly="1"/>
						<field name="origin"  invisible="1" class="oe_inline"
							readonly="1" />
					</h1>
					<group>
						<group>
							<field name="description" attrs="{'readonly': [('is_editable','=', False)]}" />
							<!-- <field name="z_partner_id" attrs="{'readonly': [('is_editable','=', False)]}"/> -->
							<field name="purchase_type" attrs="{'readonly': [('is_editable','=', False)]}" />
							<field name="z_login_id" invisible="0"/>
						</group>
						<group>
							<field name="assigned_to" invisible='1'/>
							<field name="z_check_status"/>
							<field name = 'z_check_order' invisible='1'/>
							<!-- <field name = 'z_check_order_1' attrs="{'invisible': [('z_check_order','=', 'Open')]}"/> -->
							<!-- <field name="po_status" invisible='1'/> -->
							<field name = 'z_analytic_account' attrs="{'readonly': [('is_editable','=', False)]}" invisible='1'/>
							<!-- <field name = 'z_approved_by' readonly="1"/>
							<field name = 'z_date_by' readonly="1"/> -->
						</group>
						<group>
							<!-- <field name="picking_type_id" attrs="{'readonly': [('is_editable','=', False)]}" /> -->
							<field name="company_id" groups="base.group_multi_company"
								widget="selection" attrs="{'readonly': [('is_editable','=', False)]}" />
						</group>
					</group>
					<notebook>
						<page string="Products">
							<field name="line_ids">
								<tree string = "Request Lines" editable = "bottom">
								
												<field name="is_editable" invisible="1" />
												<!-- <field name="categ_types"
													attrs="{'readonly': [('is_editable','=', False)]}" /> -->
												<field name="product_id"
													attrs="{'readonly': [('is_editable','=', False)]}" />
												<field name="name"
													attrs="{'readonly': [('is_editable','=', False)]}" />
												<field name ="product_qty"
													attrs="{'readonly': [('is_editable','=', False)]}" digits="[42, 3]"/>
												
													<field name="product_qty" class="oe_inline"
														attrs="{'readonly': [('is_editable','=', False)]}" invisible = '1' />
													<field name="product_uom_id" groups="uom.group_uom"
														invisible = '1' />
												<field name="z_qty_onhand" readonly="1"/>
												<field name="z_qty_reserve" readonly="1"/>
												<field name="z_projected_quantity" readonly="1" invisible='1'/>
												
												<field name="analytic_account_id" groups="analytic.group_analytic_accounting"
													required='1' />
												<field name="date_required"
													attrs="{'readonly': [('is_editable','=', False)]}" />

												<!-- <field name="procurement_id" invisible = '1'/> -->
												<!-- <field name="z_check" invisible = '1'/>
												<field name = 'check_boolean' attrs="{'readonly': [('z_check','=', 'Close')]}" invisible='1'/> -->

									
											
											<field name="specifications" nolabel="1"
												attrs="{'readonly': [('is_editable','=', False)]}"  invisible = '1'/>
											<field name="states" string='Status' readonly='1'/>

											<button name="button_approved" string="First Approval"
						type="object" icon="fa-check text-success" attrs="{'column_invisible': [('parent.state','=', 'draft')]}"/>
						<button name="button_second_approved" string="Second Approval"
						type="object" icon="fa-check text-success" attrs="{'column_invisible': [('parent.state','=', 'draft')]}"/>
									
						<button name="button_rejected"
						string="Reject" type="object" icon="fa-ban text-danger" attrs="{'column_invisible': [('parent.state','=', 'draft')]}"/>
								</tree>

							</field>
						</page>
						<page string="Other Info" name="otherinfo">
							<group>
								<field name="requested_by" readonly="1" />
								<field name="date_start" readonly="1"/>
								<field name="z_manufacturing_id" readonly="1"/>
								<field name="z_manufacturing_order_ref" invisible="1"/>
								<field name="z_sale_ref" readonly="1"/>
							</group>
							<group>
								<field name = 'z_level1_approved_by' readonly="1"/>
								<field name = 'z_level1_date_by' readonly="1"/>
								<!-- <field name = 'z_level2_approved_by' readonly="1"/>
								<field name = 'z_level2_date_by' readonly="1"/> -->
							</group>
						</page>
					</notebook>
				</sheet>
				<div class="oe_chatter">
					<field name="message_follower_ids" widget="mail_followers" />
					<field name="message_ids" widget="mail_thread" />
					<!-- <field name="activity_ids" widget="mail_activity" /> -->
				</div>
			</form>
		</field>
	</record>

	<record model="ir.ui.view" id="view_purchase_request_tree">
		<field name="name">purchase.request.tree</field>
		<field name="model">purchase.request</field>
		<field name="arch" type="xml">
			<tree decoration-info="state in ('draft','to_approve')" string="Purchase Request">
				<!-- <field name="message_needaction" invisible="1" /> -->
				<field name="name" />
				<field name="date_start" />
				<field name="requested_by" />
				<field name="company_id" groups="base.group_multi_company"
					widget="selection" />
				<field name="origin" />
				<field name="state"/>
				<field name="z_check_status"/>
			</tree>
		</field>
	</record>

	   <record id="view_purchase_request_search" model="ir.ui.view">
		<field name="name">purchase.request.list.select</field>
		<field name="model">purchase.request</field>
		<field name="arch" type="xml">
			<search string="Search Purchase Request">
				<field name="name" string="Purchase Request" />
				<field name="state" />
				<filter name="unassigned" string="Unassigned"
					domain="[('assigned_to','=',False)]" help="Unassigned Request" />
					
				<filter name="draft" string="Draft" domain="[('state','=','draft')]"
					help="Request is to be approved" />
					
				<filter name="state_to_approve" string="To Approve"
					domain="[('state','=','to_approve')]" help="Request is to be approved" />
				<filter name="state_approved" string="Works Manager Approved"
					 help="Level1 request is approved" />
				<filter name="state_approved" string="CEO Approved"
					 help="Level2 request is approved" />
				<filter name="state_rejected" string="Rejected"
					help="Request is rejected" />
				<filter string="Unread Messages" name="message_needaction"
					domain="[('message_needaction','=',True)]" />
				<filter name="assignedto" domain="[('assigned_to','=', uid)]" help="Assigned to me" />
				<filter name="requestby" domain="[('requested_by','=', uid)]" help="My requests" />
				<field name="requested_by" />
				<field name="assigned_to" />
				<!-- <field name="picking_type_id" /> -->
				<group expand="1" string="Group By">
					<filter string="Requested by" name="requestby" icon="terp-personal" domain="[]"
						context="{'group_by':'requested_by'}" />
					<filter string="Assigned to" name="assignedto" icon="terp-personal" domain="[]"
						context="{'group_by':'assigned_to'}" />
					<filter string="Source" name="origin" icon="terp-gtk-jump-to-rtl" domain="[]"
						context="{'group_by':'origin'}" />
					<filter string="Start Date" name="datestarted" icon="terp-go-month" domain="[]"
						context="{'group_by':'date_start'}" />
				</group>
			</search>
		</field>
	</record>  


	<record model="ir.actions.act_window" id="purchase_request_form_action">
		<field name="name">Purchase Requests</field>
		<field name="type">ir.actions.act_window</field>
		<field name="res_model">purchase.request</field>
		<field name="view_mode">tree,form</field>
		<field name="context">{"search_default_requested_by":uid}</field>
		<field name="search_view_id" ref="view_purchase_request_search" />
		<field name="help" type="html">
			<p class="oe_view_nocontent_create">
				Click to start a new purchase request process.
			</p>
			<p>
				A purchase request is an instruction to Purchasing to procure
				a certain quantity of materials services, so that they are
				available at a certain point in time.
			</p>
		</field>
	</record>


	<menuitem id="menu_purchase_request_pro_mgt" parent="purchase.menu_procurement_management"
		action="purchase_request_form_action" />


	<record id="purchase_request_line_tree" model="ir.ui.view">
		<field name="name">purchase.request.line.tree</field>
		<field name="model">purchase.request.line</field>
		<field name="arch" type="xml">
			<tree string="Purchase Request Lines" create="false">
				<field name="request_id" />
				<field name="request_state" />
				<field name="requested_by" />
				<field name="assigned_to" />
				<field name="date_required" />
				<field name="product_id" />
				<!-- <field name = 'categ_types'/> -->
				<field name="name" />
				<field name="product_qty" />
				<field name="product_uom_id" groups="uom.group_uom" />
				<field name="analytic_account_id" groups="analytic.group_analytic_accounting" />
				<field name="supplier_id" />
				<field name="purchase_id" />
				<field name = 'z_balance_quantity' readonly="1"/>
				<field name = 'z_balance_quantity_order' readonly="1"/>
				<field name = 'check_boolean' attrs="{'readonly':True}"/>
				
			</tree>
		</field>
	</record>
	<record id="purchase_request_line_form" model="ir.ui.view">
		<field name="name">purchase.request.line.form</field>
		<field name="model">purchase.request.line</field>
		<field name="priority" eval="20" />
		<field name="arch" type="xml">
			<form string="Purchase Request Line" version="7.0">
				<sheet>
					<h1>
						<field name="request_id" />
						<field name="request_state" />
					</h1>
					<group>
						<group>
							<group>
								<field name="origin" attrs="{'readonly': [('is_editable','=', False)]}" />
								<field name="requested_by" attrs="{'readonly': [('is_editable','=', False)]}" />
								<field name="assigned_to" attrs="{'readonly': [('is_editable','=', False)]}" />
								<field name="description" attrs="{'readonly': [('is_editable','=', False)]}" />
								<field name="date_start" attrs="{'readonly': [('is_editable','=', False)]}" />
								<field name="company_id" groups="base.group_multi_company"
									widget="selection" attrs="{'readonly': [('is_editable','=', False)]}" />
								<field name="is_editable" invisible="1" />
							</group>
						</group>
						<group>
							<!-- <field name="categ_types" attrs="{'readonly': [('is_editable','=', False)]}" /> -->
							<field name="product_id" attrs="{'readonly': [('is_editable','=', False)]}" />
							<field name="name" attrs="{'readonly': [('is_editable','=', False)]}" />
							<label for="product_qty" />
							<div>
								<field name="product_qty" class="oe_inline"
									attrs="{'readonly': [('is_editable','=', False)]}" />
								<field name="product_uom_id" groups="uom.group_uom"
									class="oe_inline" attrs="{'readonly': [('is_editable','=', False)]}" />
							</div>
							<field name="analytic_account_id" groups="analytic.group_analytic_accounting"
								domain="[('type','not in',('view','template'))]" required='1' />
							<field name="date_required" attrs="{'readonly': [('is_editable','=', False)]}" />
							<!-- <field name="procurement_id" /> -->
							<field name="purchase_id" />
							<field name = 'z_balance_quantity' readonly="1"/>
							<field name = 'z_balance_quantity_order' readonly="1"/>
							<field name = 'check_boolean' attrs="{'readonly':True}"/>
						</group>
					</group>
					<group>
						<separator string="Specifications" />
						<newline />
						<field name="specifications" nolabel="1"
							attrs="{'readonly': [('is_editable','=', False)]}" />
					</group>
					<notebook>
					</notebook>
				</sheet>
				<!-- <div class="oe_chatter">
					<field name="message_follower_ids" widget="mail_followers" />
					<field name="message_ids" widget="mail_thread" />
					<field name="activity_ids" widget="mail_activity" />
				</div> -->
			</form>
		</field>
	</record>

	<record id="purchase_request_line_search" model="ir.ui.view">
		<field name="name">purchase.request.line.search</field>
		<field name="model">purchase.request.line</field>
		<field name="arch" type="xml">
			<search string="Search Purchase Request">
				<field name="request_id" />
				<field name="product_id" />
				<field name="requested_by" />
				<field name="assigned_to" />
				<field name="date_start" />
				<field name="date_required" />
				<field name="analytic_account_id" />
				<!-- <field name="procurement_id" /> -->
				<filter name="request_state_draft" string="Draft"
					domain="[('request_state','=','draft')]" help="Request is to be approved" />
				<filter name="request_state_to_approve" string="To Approve"
					domain="[('request_state','=','to_approve')]" help="Request is to be approved" />
				<filter name="request_state_approved" string="Works Manager Approved"
					help="Request is approved" />
				<filter name="request_state_approved" string="CEO Approved"
					 help="Request is approved" />	
				<filter name="request_state_rejected" string="Rejected"
					 help="Request is rejected" />
				<filter name="assignedto" domain="[('assigned_to','=', uid)]" help="Assigned to me" />
				<filter name="requestby" domain="[('requested_by','=', uid)]" help="My requests" />
				<group expand="1" string="Group By">
					<filter string="Product" domain="[]" name="product"
						context="{'group_by' : 'product_id'}" />
					<filter string="Requested by" domain="[]" name="requestby"
						context="{'group_by':'requested_by'}" />
					<filter string="Assigned to" domain="[]" name="assignedto"
						context="{'group_by':'assigned_to'}" />
					<filter string="Request status" domain="[]" name="requeststate"
						context="{'group_by':'request_state'}" />
					<filter string="Analytic Account" domain="[]" name="analytic_account"
						context="{'group_by':'analytic_account_id'}" />
				</group>
			</search>
		</field>
	</record>

	 <act_window
		context="{'search_default_product_id': [active_id], 'default_product_id': active_id}"
		id="action_purchase_request_line_product_tree" 
		name="Purchase Requests"
		res_model="purchase.request.line" 
		binding_model="product.product"
		groups="group_purchase_request_user,group_purchase_request_manager" />


	<record id="purchase_request_line_form_action" model="ir.actions.act_window">
		<field name="name">Purchase Request Lines</field>
		<field name="type">ir.actions.act_window</field>
		<field name="res_model">purchase.request.line</field>
		<field name="view_mode">tree,form</field>
		<field name="domain">[('request_state','!=','draft')]</field>
	</record>

	 <record id="purchase_request_line_form_action_tree" model="ir.actions.act_window.view">
		<field eval="1" name="sequence" />
		<field name="view_mode">tree</field>
		<field name="view_id" ref="purchase_request_line_tree" />
		<field name="act_window_id" ref="purchase_request_line_form_action" />
	</record>

	<record id="purchase_request_line_form_action_form2" model="ir.actions.act_window.view">
		<field eval="2" name="sequence" />
		<field name="view_mode">form</field>
		<field name="view_id" ref="purchase_request_line_form" />
		<field name="act_window_id" ref="purchase_request_line_form_action" />
	</record>

	<menuitem action="purchase_request_line_form_action" id="menu_purchase_request_line"
		parent="purchase.menu_procurement_management" />

	<menuitem name="Purchase Request" id="parent_menu_purchase_request" web_icon="purchase_request,static/description/icon_image.png"/>


	<menuitem id="parent_menu_purchase_request" name="Purchase requests"
		groups="group_purchase_request_user,group_purchase_request_manager" />

	<menuitem id="menu_purchase_request" name="Purchase Requests"
		parent="parent_menu_purchase_request" groups="group_purchase_request_user,group_purchase_request_manager" />
	<menuitem id="menu_purchase_request_act" sequence="10"
		parent="menu_purchase_request" action="purchase_request_form_action" />
	<menuitem id="menu_purchase_request_line_act" sequence="20"
		parent="menu_purchase_request" action="purchase_request_line_form_action" />



	<record id="purchase_order_request" model="ir.ui.view">
		<field name="name">purchase.order.form</field>
		<field name="model">purchase.order</field>
		<field name="inherit_id" ref="purchase.purchase_order_form"/>
		<field name="arch" type="xml">
			<field name = "partner_ref" position = "after">
				<field name = "purchase_request_id" />
				<field name = "reference"/>
				<field name="z_balance_check" invisible="1"/>
			</field>
			<xpath expr="//field[@name='order_line']/tree/field[@name='product_id']" position="after">
				<field name = 'purchase_request_id' invisible = '1'/>
				<field name = 'purchase_request_line' invisible = '1'/>
				<field name="z_balance_qty" invisible="1"/>
			</xpath>    
		</field>
	</record>
	<record id="purchase_order_request1" model="ir.ui.view">
		<field name="name">purchase.order.line.form2</field>
		<field name="model">purchase.order.line</field>
		<field name="inherit_id" ref="purchase.purchase_order_line_form2"/>
		<field name="arch" type="xml">
			
				
			
			<field name = "product_id" position = "after">
				<field name = "purchase_request_id" invisible = '1'/>
				<field name = "purchase_request_line" invisible = '1'/>

			</field>

		</field>
	</record>
	<!-- <record id="inherit_stock_move_request1" model="ir.ui.view">
		<field name="name">stock.move.request1</field>
		<field name="model">stock.move</field>
		<field name="inherit_id" ref="stock.view_move_form"/>
		<field name="arch" type="xml">
			
				
			
			<field name = "product_id" position = "after">
				<field name = "z_sale_order" invisible = '1'/>
			</field>

		</field>
	</record> -->
	<record  model="ir.actions.act_window" id="purchase_form_action_view_active">
			<field name="name">Purchase Request</field>
			<field name="res_model">purchase.request</field>
			<field name="view_mode">tree,form</field>
			<field name="view_ids" eval="[(5, 0, 0),
						  (0, 0, {'view_mode': 'tree', 'view_id': ref('view_purchase_request_tree')}),
						  (0, 0, {'view_mode': 'form', 'view_id': ref('view_purchase_request_form')})]"/>
			<field name="domain">[('z_manufacturing_order_ref', '=', active_id)]</field>
		</record>
		<!-- configuration menu in purchase request -->

	<record model="ir.ui.view" id="purchase_request_configuration_view">
			<field name="name">purchase_request_config.tree</field>
			<field name="model">res.approval</field>
			<field name="arch" type="xml">
				<tree string="Configuration">
					<field name="name"/>
				</tree>
			</field>
	 </record>
	 <record model="ir.ui.view" id="purchase_type_configuration_form_view">
		<field name="name">purchase_type_config.form</field>
		<field name="model">purchase.type.user</field>
		<field name="arch" type="xml">
			<form string="Purchase Type form">
				<group>
					<group>
						<field name='name'/>
					</group>
				</group>
			</form>
		</field>
	</record>
	 <record model="ir.ui.view" id="purchase_request_configuration_form_view">
			<field name="name">purchase_request_config.tree</field>
			<field name="model">res.approval</field>
			<field name="arch" type="xml">
			<form string="Configuration form">
			<sheet>
				<group>
					<group>
						<field name="name" string="Purchase Request Type"/>
						 <field name="validation_type" widget='radio'/>
						<!-- <field name="level_one_approver" widget='many2many_tags'/>
						<field name="level_two_app rover"/> -->
					</group>
				</group>
				<notebook>
				<page string="Approval 1" attrs="{'invisible': [('validation_type', '=', False)]}">
                        <field name="z_order_line_id" editable ="bottom">
                            <tree editable ="bottom">
                                <field name="z_purchase_request_approve"/>
                                <field name="approval_line_id" invisible="1"/>
                                <!-- <field name="levels" /> -->
                                <!-- <field name="z_analytic_account"/> -->
                            </tree>
                        </field>
                    </page>
				<page string="Approval 2" attrs="{'invisible': ['|',('validation_type', '=', 'first_level'),('validation_type', '=', False)]}">
                        <field name="z_order_line2_id" editable ="bottom">
                            <tree editable ="bottom">
                                <field name="z_purchase_request_approve2"/>
                                <field name="approval_line2_id" invisible="1"/>
                                <!-- <field name="levels" /> -->
                                <!-- <field name="z_analytic_account"/> -->
                            </tree>
                        </field>
                    </page>
				</notebook>
			</sheet>
			</form>
			</field>
	 </record>

	<record id="configuration_action1" model="ir.actions.act_window">
			<field name="name">Configuration</field>
			<field name="type">ir.actions.act_window</field>
			<field name="res_model">res.approval</field>
			<field name="view_mode">form</field>
			<field name="domain">[]</field>
			<field name="context">{}</field>
			<field name="view_ids" eval="[(5, 0, 0),
						  (0, 0, {'view_mode': 'tree', 'view_id': ref('purchase_request_configuration_view')}),
						  (0, 0, {'view_mode': 'form', 'view_id': ref('purchase_request_configuration_form_view')})]"/>
			<!-- <field name="view_id" ref="purchase_request_configuration_view"/> -->
		</record>

<menuitem
			id="purchase_request_configuration_menu"
			name="Configuration"
			parent="parent_menu_purchase_request"/>

<menuitem
			id="purchase_request_approval"
			name="Purchase Request Approval"
			action="configuration_action1"
			parent="purchase_request_configuration_menu"
			sequence="1"/>

</odoo>